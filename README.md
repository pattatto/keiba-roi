# 競馬 収支管理（重賞）

重賞（G1/G2/G3）を中心に、投資額・回収額・回収率・収支を手軽に記録・分析できるシンプルなフロントエンドアプリです。データはブラウザのローカルに保存され、JSON/CSVでバックアップ・移行ができます。PWA対応により、ホーム画面追加・オフライン起動が可能です。

## 主な機能
- 記録の追加: 日付、レース、投資額、回収額、メモ
- 一覧と操作: 並び替え（投資/回収/回収率）、フィルタ（キーワード/種別/G1-G3/日付/回収率100%）
- サマリ: 件数、総投資、総回収、回収率、収支の表示＋回収率の推移チャート
- インポート/エクスポート: JSON書き出し、JSON/CSV/TSV取り込み
- テーマ切替: ダーク/ライト
- PWA: ホーム画面に追加、オフライン起動（初回はオンラインでアクセスしてキャッシュ）

## データの保存
- 保存先: ブラウザの`localStorage`（キー: `keiba_roi_records_v1`）
- 端末/ブラウザごとに独立。履歴やサイトデータの削除で消える場合があります。
- バックアップ: 「エクスポート」でJSONを保存、「インポート」でJSON/CSVを読み込み可能。

## 使い方（ローカルで確認）
1. 任意のHTTPサーバで配信（例: Python）
   ```sh
   # プロジェクトの1つ上のディレクトリで
   python3 -m http.server 5173
   ```
2. ブラウザで `http://localhost:5173/keiba-roi/` を開く

※ `file:///` で直接開くとService Workerが動かず、PWA機能は使えません。

## デプロイ（GitHub Pages）
1. このディレクトリをGitHubへpush（例: `main`ブランチ）
2. GitHub リポジトリ → Settings → Pages
   - Source: 「Deploy from a branch」
   - Branch: `main` / `(root)` を選択 → Save
3. 数分後に `https://<ユーザー名>.github.io/keiba-roi/` が公開

## スマホへのインストール（PWA）
- Android/Chrome: メニュー →「ホーム画面に追加」
- iOS/Safari: 共有ボタン →「ホーム画面に追加」
- 初回はオンラインで開き、アセットがキャッシュされるとオフラインでも起動できます。

## CSV取り込みについて
- 区切り文字は自動判定（カンマ/タブ/セミコロン）
- ヘッダの同義語を幅広く許容（例）
  - 日付: `日付`, `date`, `日時`
  - レース: `レース`, `race`, `競走名`, `大会`, `レース名`
  - 投資額: `投資`, `投資額`, `bet`, `stake`, `購入`, `購入額`, `購入金額`
  - 回収額: `回収`, `回収額`, `払戻`, `払戻金`, `payout`, `return`, `払戻金額`
  - メモ: `メモ`, `memo`, `備考`, `note`
- サンプル: `template.csv` を参照

## 開発メモ
- ビルド不要の静的サイト構成
- 主なファイル
  - `index.html`: 画面構造
  - `styles.css`: スタイル
  - `app.js`: ロジック（保存/表示/チャート/インポート等）
  - `races.js`: 重賞レース一覧（G1/G2/G3）
  - `manifest.json`: PWAマニフェスト（名前/色/アイコン等）
  - `sw.js`: Service Worker（プリキャッシュ＋キャッシュファースト）
  - `icons/`: PWAアイコン（`192x192`, `512x512`, iOS向け`180x180`）

## 注意事項
- iOSのプライベートブラウズ、あるいは一部の制限環境では`localStorage`やキャッシュが使えない場合があります。
- PWAの更新はバックグラウンドで取得され、次回起動時に反映されることがあります。

